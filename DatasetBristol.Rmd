---
author: Generated by bookdown
output:
  bookdown::pdf_document2:
    fig_caption: yes
    latex_engine: xelatex
header-includes:
   - \usepackage{floatrow}
   - \floatsetup[figure]{capposition=top}
classoption: landscape
---
## Bristol {#DatasetBristol}

```{r DatasetBristolPaths, include=FALSE}
path = "/Users/travel_mechtal/Documents/UWE/Portfolio/"
```

```{r DatasetBristolLibraries, include=FALSE}
#---------------------------------------
# Knitting to pdf
#---------------------------------------
if(!require(knitr)){install.packages("knitr")}
library(knitr)
#---------------------------------------
if(!require(kableExtra)){install.packages("kableExtra")}
library(kableExtra)
#---------------------------------------
# Plotting
#---------------------------------------
if(!require(ggplot2)){install.packages("ggplot2")}
library(ggplot2)
#---------------------------------------
# Working with objects
#---------------------------------------
if(!require(readr)){install.packages("readr")}
library(readr) #read_csv
#---------------------------------------
# Working with objects
#---------------------------------------
if(!require(dplyr)){install.packages("dplyr")}
library(dplyr) #rename
#---------------------------------------
if(!require(psych)){install.packages("psych")}
library(psych) #describing data
#---------------------------------------
if(!require(reshape2)){install.packages("reshape2")}
library(reshape2) #melt
```

```{r DatasetBristolRFunctions, include=FALSE}
#---------------------------------------
# My function for a list view
#---------------------------------------
source("my_kable.R")
#---------------------------------------
# My function for a conclusion
#---------------------------------------
conclusion <- function(dose, myAge, dataset) {
  return(paste(
          filter(dataset, date==get(paste("my", dose, sep='')) & age==myAge)[dose],
          "people in my age group got their", 
          dose, 
          "jabs with me in Bristol."
          )
         )
}
```

```{r DatasetBristol, include=FALSE}
# read the dataset
dataset <- read.csv(paste0(path,"ltla_2022-03-25.csv"),
                         header = TRUE,
                         sep = ","
                         )

# change date's format
dataset$date <- as.Date(dataset$date,format = '%Y-%m-%d')

# choose necessary columns
dataset <- dataset[,c("date", "age",
                      "newPeopleVaccinatedFirstDoseByVaccinationDate",
                      "newPeopleVaccinatedSecondDoseByVaccinationDate",
                      "newPeopleVaccinatedThirdInjectionByVaccinationDate")]
```

The dataset's columns:

```{r DatasetBristolColumns, echo=FALSE}
my_kable(colnames(dataset))
```

Just rename columns and we will move on to answer the questions.
```{r DatasetBristolNewNames, echo=FALSE}
dataset = rename(dataset, 
       First = newPeopleVaccinatedFirstDoseByVaccinationDate
       ,Second = newPeopleVaccinatedSecondDoseByVaccinationDate
       ,Third = newPeopleVaccinatedThirdInjectionByVaccinationDate
         )

dataset <- dataset[c("age", "date", "First", "Second", "Third")]

kable(head(dataset))
```

### Question 1
```{r ref0, ref.label='q1', render=pander::pander, echo=FALSE}
```

I suggest looking at this graph from left to right and from down to up.
Also, I put my dates on the graphs as the red lines.

```{r DatasetBristolVariables, include=FALSE}
myFirst <- as.Date("2021-08-08", format="%Y-%m-%d")
mySecond <- as.Date("2021-10-03", format="%Y-%m-%d")
myThird <- as.Date("2022-01-08", format="%Y-%m-%d")
myAge <- "25_29"
```

```{r DatasetBristolFirst, include=FALSE}
dose = "First"
```

```{r DatasetBristolAgePlot,  fig.height = 10, fig.width = 12, fig.align = "center", echo=FALSE}
ggplot(data = dataset, 
       aes_string(x="date", 
           y=dose,
           colour="age")
       ) +
  geom_line() +
  facet_grid(age ~ .) +
  geom_vline(xintercept = get(paste("my", dose, sep='')), color = "red")
```
```{r DatasetBristolFirstConlusion, render=pander::pander, echo=FALSE}
conclusion(dose, myAge, dataset)
```

We can see that the active phases of the vaccination depends on the age group. The first group was people 90 years and older. The last one is the people 12-15 years old. It is not surprising, because, as I know, it was a government strategy.

Look at the graph for the second dose.

```{r DatasetBristolSecond, echo=FALSE, fig.height = 10, fig.width = 12, fig.align = "center"}
dose <- "Second"
<<DatasetBristolAgePlot>>
```
```{r DatasetBristolSecondConclusion, echo=FALSE, render=pander::pander}
conclusion(dose, myAge, dataset)
```

The second dose is 2 months after the first. And we can see the waves too.

Look at the graph for the third dose.

```{r DatasetBristolThird, echo=FALSE, fig.height = 10, fig.width = 12, fig.align = "center"}
dose <- "Third"
<<DatasetBristolAgePlot>>
```

```{r DatasetBristolThirdConclusion, echo=FALSE, render=pander::pander}
conclusion(dose, myAge, dataset)
```

So, my date of the vaccination was not in the active phase.
And I canâ€™t imagine how many people were in the vaccination centre at the end of December 2021.

Overall, I got my jabs in the not active phases of the vaccination, but I got the third one with a lot of people. And the count of jabs depends on dates. Keep this fact in mind.

### Question 0
```{r ref0, ref.label='q0', render=pander::pander, echo=FALSE}
```

```{r DatasetBristolStudentLongDataset, include=FALSE}
# students dataset
dataset_student_long <- melt(filter(dataset, age=="18_24"), id.vars = c("date")
                       , measure.vars = c("First", "Second", "Third")
                       , variable.name = "Dose"
                       , value.name = "Count"
                    )
```

There are two large universities in Bristol. I guess that the vaccination waves also depend on the academic year events.

I will be use term-dates of UWE academic years:
[2020-2021](https://www.uwe.ac.uk/study/term-dates/2020-21-term-dates), [2021-2022](https://www.uwe.ac.uk/study/term-dates/2021-22-term-dates), 
[2022-2023](https://www.uwe.ac.uk/study/term-dates/2022-23-term-dates).

```{r DatasetBristolStudentPlot, echo=FALSE, fig.height = 7, fig.width = 12, fig.align = "center"}
ggplot(data = dataset_student_long,
       aes(x=date, y=Count)) +
    geom_rect(aes(xmin = as.Date("2020-10-19"),
            xmax = as.Date("2021-01-22"),
                ymin = -Inf, ymax = Inf, fill = '20/21 Teaching Block 1: Autumn Term'), alpha = .2)+
    geom_rect(aes(xmin = as.Date("2021-02-08"),
            xmax = as.Date("2021-05-07"),
                ymin = -Inf, ymax = Inf, fill = '20/21 Teaching Block 2: Spring Term'), alpha = .2)+
    geom_rect(aes(xmin = as.Date("2021-05-24"),
            xmax = as.Date("2021-08-06"),
                ymin = -Inf, ymax = Inf, fill = '20/21 Teaching Block 3: Summer Term'), alpha = .2)+
    geom_rect(aes(xmin = as.Date("2021-09-27"),
            xmax = as.Date("2022-01-28"),
                ymin = -Inf, ymax = Inf, fill = '21/22 Teaching Block 1: Autumn Term'), alpha = .2)+
  geom_line() +
  facet_grid(Dose ~ .) +
  theme(axis.text.x = element_text(angle=90, hjust = 1)) +
  scale_x_date(date_breaks = "months" , date_labels = "%b-%y") +
  #scale_fill_brewer(palette = 'Dark2', name = 'Year') +
  scale_fill_hue(c=45, l=80) +
  guides(colour=guide_legend(title="Terms")) 
```

The result is interesting but requires research.
As I can see, the active phase of the vaccination for the age group 18-24 was during the Summer term. But why?
It may be because students decided to prepare themselves for the new academic year. It may be because of the government or NHS suggestions. It is an open question.